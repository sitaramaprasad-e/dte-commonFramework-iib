pipeline {
   	agent any
	stages{
		stage('Checkout Code'){
           	 steps {
              	  checkout([$class: 'GitSCM', branches: [[name: '*/feature']], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'load']], submoduleCfg: [], userRemoteConfigs: [[url: 'git@github.com:sitaramaprasad-e/dte-commonFramework-iib.git']]])
          	  }
          
       } 
       stage('Execute MQ scripts on Remote server'){
       		steps{
			sh 'whoami'
			sh 'sudo -i'
			sh 'whoami'
			 //sh 'ssh -v -i /home/iibadm/.ssh/id_rsa iibadm@10.0.10.160;sudo -i' 
			  //Copying the script file to target server
			sudo -u iibadm -s;whoami;scp ./MQ/deploymq.sh iibadm@10.0.10.160:/home/iibadm
			 // Change the permissions of the file 
			 sh 'ssh jenkins@10.0.10.160 chmod +x deploymq.sh'
			 //Run the script on remote server
			 sh 'ssh -o StrictHostKeyChecking=no jenkins@10.0.10.160 "cd /home/jenkins; ./deploymq.sh PBCTEST1"'
			 // Delete the script file from the remote server
			 sh 'ssh jenkins@10.0.10.160 "rm -rf /home/jenkins/deploymq.sh"'
    		
		}
       }
       stage('Execute IIB scripts on Remote server'){
       		steps{
			  // sh 'ssh -v -i id_rsa iibadm@10.0.10.160' 
			  //Copying the script file to target server
			 sh 'scp ./IIB/configurations/deploy_iib_conf_svcs.sh jenkins@10.0.10.160:/home/jenkins'
			 // Change the permissions of the file 
			 sh 'ssh jenkins@10.0.10.160 chmod +x deploy_iib_conf_svcs.sh'
			 //Run the script on remote server
			 sh 'ssh -o StrictHostKeyChecking=no jenkins@10.0.10.160 "cd /home/jenkins; ./deploy_iib_conf_svcs.sh TEST TEST TEST DEV"'
			 // Delete the script file from the remote server
			 sh 'ssh jenkins@10.0.10.160 "rm -rf /home/jenkins/deploy_iib_conf_svcs.sh"'
    		
		}
       }
     
	     }
	      
}
